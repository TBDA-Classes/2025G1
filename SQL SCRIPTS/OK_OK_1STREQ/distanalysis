# -*- coding: utf-8 -*-
"""
Created on Tue Nov 04 15:20:00 2025
@author: jairi
"""
# IMPORT LIBRARIES
import pandas as pd
import numpy as np
from skimage.filters import threshold_multiotsu
import sys # Para usar exit()

# --- Carga de datos ---
nombre_archivo = r"C:\Users\jairi\Downloads\holaa.csv.csv"
print(f"Cargando datos desde '{nombre_archivo}'...")
try:
    df = pd.read_csv(nombre_archivo) # Usamos read_csv porque es un archivo .csv
except FileNotFoundError:
    print(f"Error: No se encontró el archivo '{nombre_archivo}'.")
    print("Asegúrate de que el archivo 'holaa.csv' esté en tu carpeta Downloads.")
    sys.exit() # Detiene la ejecución
except Exception as e:
    print(f"Ocurrió un error inesperado al cargar el archivo: {e}")
    sys.exit()

# PREPARE DATA
try:
    data = df['distinct_vars_count'].values
except KeyError:
    print("Error: El CSV debe tener la columna 'distinct_vars_count'")
    data = None
except NameError:
    data = None # df no se definió

# APPLY MULTI-OTSU THRESHOLDING
if data is not None:
    try:
        # Apply Multi-Otsu to find 2 thresholds for 3 classes
        thresholds_otsu = threshold_multiotsu(data, classes=3)
    
        threshold1 = thresholds_otsu[0]
        threshold2 = thresholds_otsu[1]

        # DEFINE STATES BASED ON THRESHOLDS
        thresh1_int = int(np.floor(threshold1))
        thresh2_int = int(np.floor(threshold2))

        print(f"\n--- Umbrales Estadísticos (Otsu's Method) ---")
        print(f"Umbral 1 (Idle vs Intermediate): {threshold1:.2f}")
        print(f"Umbral 2 (Intermediate vs Active): {threshold2:.2f}")

        print(f"\n--- Definiciones de Estado Propuestas ---")
        print(f"Idle: distinct_vars_count <= {thresh1_int}")
        print(f"Intermediate: {thresh1_int} < distinct_vars_count <= {thresh2_int}")
        print(f"Active: distinct_vars_count > {thresh2_int}")

    except Exception as e:
        print(f"Error durante el análisis Otsu: {e}")
