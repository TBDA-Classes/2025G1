-- This idea to identify the most relevant days was sebsequent to the analysis done in the previous scripts (04_script_act_score and 06_final_labeling).
-- if validated, the results could modify the approach to analyzing machine activity by focusing on the most active days. on following scripts
-- PURPOSE: To identify the most relevant (most active) days for analysis.
-- METHODOLOGY: This query counts the daily records in both the string and float log tables,
-- then joins and sums them to create a total activity score for each day.
-- The results are ordered to show the most active days first.

WITH string_days AS (
    -- First, count the number of string log entries for each day.
    SELECT
        to_char(date_trunc('day', to_timestamp(date / 1000.0)), 'YYYY-MM-DD') AS day,
        COUNT(*) AS string_count
    FROM
        public.variable_log_string
    GROUP BY
        day
),

float_days AS (
    -- Next, count the number of float log entries for each day.
    SELECT
        to_char(date_trunc('day', to_timestamp(date / 1000.0)), 'YYYY-MM-DD') AS day,
        COUNT(*) AS float_count
    FROM
        public.variable_log_float
    GROUP BY
        day
)

-- Finally, join the two counts and calculate the total.
SELECT
    s.day,
    s.string_count,
    f.float_count,
    (s.string_count + f.float_count) AS total_count
FROM
    string_days s
JOIN
    float_days f ON s.day = f.day
ORDER BY
    total_count DESC;